
-- Найти все компании поставщиков из тех стран, в которые делают заказы заказчики
SELECT s.company_name
FROM suppliers s
WHERE country IN (SELECT DISTINCT country FROM customers)
-- То же самое
SELECT DISTINCT s.company_name
FROM suppliers s
JOIN customers USING(country);


-- Кринж синтетический пример задачи
SELECT c.category_name, SUM(p.units_in_stock)
FROM products p
INNER JOIN categories c USING(category_id)
GROUP BY c.category_name
ORDER BY SUM(p.units_in_stock) DESC
LIMIT(
	SELECT MIN(product_id) + 4 FROM products
);


-- Товары, количество которых в наличии больше чем в среднем
SELECT p.product_name, p.units_in_stock
FROM products p
WHERE p.units_in_stock > (
	SELECT AVG(units_in_stock)
	FROM products
)
ORDER BY p.units_in_stock;



-------------------------------------------------------------------------- WHERE EXISTS

-- WHERE EXISTS возвращает true, когда в подзапросе была возвращена хотя бы одна строка

-- Компании и имена заказчиков, которые делали заказы весом от 50 до 100
SELECT c.company_name, c.contact_name
FROM customers c
WHERE EXISTS (
	SELECT customer_id
	FROM orders o
	WHERE customer_id = c.customer_id  -- customer_id совпадает
	AND o.freight BETWEEN 50 AND 100   -- заказ от 50 до 100
)
ORDER BY c.company_name, c.contact_name;
-- То же самое
SELECT DISTINCT c.company_name, c.contact_name
FROM customers c
INNER JOIN orders o USING(customer_id)
WHERE o.freight BETWEEN 50 AND 100
ORDER BY c.company_name, c.contact_name;






